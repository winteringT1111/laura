{% extends "base.html" %}
{% load static %}
{% block head %}
<link rel="stylesheet" type="text/css" href="{% static 'css/fishing.css' %}">
{% endblock %}

{% block content %}

<div class="fishing-page-container">
    
    <!-- 안내 사항 -->
    <div class="info-panel">
        <h3><i class="fas fa-info-circle"></i> 낚시터 안내</h3>
        <p>낚싯대를 던져 희귀한 물고기나 재료를 낚아보세요! 낚시에는 10 EXP가 소모됩니다.</p>
        <p>다른 모험가들의 낚시 기록을 확인하고 최고 점수에 도전해보세요!</p>
    </div>

    <!-- 점수 및 리더보드 -->
    <div class="score-leaderboard">
        <div class="user-score">
            <h4>나의 점수</h4>
            <p>{{ user_score }} 점</p>
        </div>
        <div class="leaderboard">
            <h4>랭킹 TOP 3</h4>
            <ol>
                {% for player in leaderboard %}
                    <li>{{ player.char.charName }} - {{ player.fishing_score }} 점</li>
                {% empty %}
                    <li>랭킹 정보 없음</li>
                {% endfor %}
            </ol>
        </div>
    </div>

    <!-- 낚싯대 던지기 버튼 -->
    {% if user_exp >= 10 %}
        <a href="{% url 'store:create_fishing_log_page' %}" class="cast-button">낚싯대 던지기!</a>
    {% else %}
        <button class="cast-button-disabled" disabled>경험치 부족</button>
    {% endif %}

    <!-- 낚시 로그 피드 -->
    <div class="fishing-log-feed">
    <h4>낚시 기록</h4>

    {# ⬇️ 여기서 메인 루프 시작 #}
    {% for log_data in fishing_logs %}
        <div class="log-post-new">
            <div class="log-author-profile">
                <img src="{% static 'img/charac/' %}{{ log_data.log.author.charEngName}}2.png" alt="{{ log_data.log.author.charName }}">
            </div>
            <div class="log-details">
                <div class="log-title-line">
                    <span class="log-title">{{ log_data.log.author.charName }}</span>
                    <span class="log-quest-info"> | {{ log_data.log.catch_description }}</span>
                </div>
                <div class="log-content-new">
                    <p>{{ log_data.log.action_description|default:log_data.log.catch_description|linebreaksbr }}</p>
                </div>
                <div class="log-comments-new">
                    {% for comment_data in log_data.processed_comments %}
                        <div class="auto-comment-new">
                            {% if comment_data.icon_name %}
                                <img src="{% static 'img/store/' %}{{ comment_data.icon_name }}" class="reward-icon" alt="보상 아이템">
                            {% endif %}
                            <span>{{ comment_data.text }}</span>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

    {% empty %}
        <p class="no-logs">아직 낚시 기록이 없습니다.</p>


    {% endfor %}

</div>



</div>

{% endblock %}