{% extends "base.html" %}
{% load static %}

{% block head %}
<link rel="stylesheet" type="text/css" href="{% static 'css/member/profile.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'css/member/inven.css' %}">
{% endblock %}

{% block content %}

<div class="overlay"></div> <!-- 흐림 효과 적용 영역 -->

<a href="/member" class="goback">RETURN</a>

<div class="content">


<div class="character_wrap fade-in-left" id="grade7">
    <div class="cha">
        <img class="character" src="{% static 'img/charac/' %}{{char.charEngName}}.png"></img>
    </div>
</div>

{% if char.charProfileMusic %}
<div id="profile_music" class="hidden" data-music="{{char.charProfileMusic}}.mp3"></div>
{% else %}
{% endif %}

<div class="wrap fade-in-right">
    <div class="inven">
        <i class="fa-solid fa-circle-user"></i>
        <!--<i class="fa-solid fa-address-book"></i>-->
        <i class="fa-solid fa-briefcase"></i>
    </div>


    <div class="info_wrap" id="profile-section">
        <div class="content1">
            <div class="catchphrase">
                <p>{{char.charCatchPhrase}}</p>
            </div>
            <div class="name_wrap">
                <img class="position" src="{% static 'img/profile/'%}{{char.charPosition}}.png" alt="position">
                <div class="name_info">
                    <p>{{char.charName}}</p>
                    <p>{{char.charEngName}}</p>
                    <p>{{char.charSpecies}}</p>
                </div>
                <img class="star" src="{% static 'img/profile/star.png' %}" alt="star">
            </div>
            <div class="sub_wrap">
                <div class="lines">
                    <p>{{char.charPhrase}}</p>
                </div>
                <div class="sub_info">
                    {{char.charSex}} | {{char.charAge}}세 | {{char.charHeight}}cm | {{char.charWeight}}kg
                </div>
            </div>
        </div>
          
        <div class="content2"> 
            <button class="sub_section">
                <span>PERSONALITY</span>
            </button>
            {% if char07.charCommission  or char07.charImageInfo %}
            <button class="sub_section">
                <span>APPEARANCE</span>
            </button>
            {% endif %}
            <button class="sub_section">
                <span>ETC</span>
            </button>
            <button class="sub_section">
                <span>STATS</span>
            </button>
        </div>

        <div class="content_personality">
            <div class="keyword_wrap">
                <div class="keyword">
                    <img class="prof_star" src="{% static 'img/profile/personality.png' %}" alt="position">
                    {{char.charKeyword1}}
                </div>
                <div class="keyword">
                    <img class="prof_star" src="{% static 'img/profile/personality.png' %}" alt="position">
                    {{char.charKeyword2}}
                </div>
                <div class="keyword">
                    <img class="prof_star" src="{% static 'img/profile/personality.png' %}" alt="position">
                    {{char.charKeyword3}}
                </div>
            </div>

            <div class="scroll_box">
                <p>
                    {{char.charPersonality|linebreaksbr|safe}}
                </p>
            </div>
        </div>

        <div class="content_appearance">
            <div class="keyword_wrap">
                <div class="keyword">
                    {% if char07.charCommission %}
                    <img class="prof_star" src="{% static 'img/profile/personality.png' %}" alt="position">
                    vvr325_3
                    {% endif %}
                </div>
            </div>

            <div class="scroll_box">
                {% if char.charImageInfo %}
                <p>
                    {{ char.charImageInfo|linebreaksbr|safe }}  
                </p>
                {% endif %}
            </div>
        </div>

        <div class="content_etc">
            <div class="keyword_wrap">
                <div class="keyword">
                </div>
            </div>

            <div class="scroll_box2">
                <p>
                    {{ char.charEtc|linebreaksbr|safe }}  
                </p>
            </div>
        </div>

        <div class="content_stats">
            <div class="progressbar">
                <div class="stat">
                <label>체력</label>
                <progress value="{{char.charHP}}" max="5"></progress>
                </div>
                <div class="stat">
                <label>공격력</label>
                <progress value="{{char.charATK}}" max="5"></progress>
                </div>
                <div class="stat">
                <label>방어력</label>
                <progress value="{{char.charDEF}}" max="5"></progress>
                </div>
                <div class="stat">
                <label>회복력</label>
                <progress value="{{char.chaRES}}" max="5"></progress>
                </div>
                <div class="stat">
                <label>운</label>
                <progress value="{{char.charLUK}}" max="5"></progress>
                </div>
            </div>
            
            <div class="skill_wrap">
                <div class="skill_title">
                    <span>SKILL</span>
                    <img class="prof_star" src="{% static 'img/profile/personality.png' %}" alt="position">
                </div>
                <div class="skill_info">
                    <div class="skill_content">
                        <p class="skill_name">{{char.charSkill1}}</p>
                        <p class="skill_ex">{{char.charSkill1info}}</p>
                    </div>
                    <div class="skill_content">
                        <p class="skill_name">{{char.charSkill2}}</p>
                        <p class="skill_ex">{{char.charSkill2info}}</p>
                    </div>
                    <div class="skill_content">
                        <p class="skill_name">{{char.charSkill3}}</p>
                        <p class="skill_ex">{{char.charSkill3info}}</p>
                    </div>
                </div>
            </div>


            

        </div>
    </div>

    <!-- 

    <div class="info_wrap" id="relation-section">
        dd
    </div>

    -->

    <div class="info_wrap" id="inven-section">
        <div class="inven_content">
            <img class="header" src="{% static 'img/profile/'%}inventory_header.png" alt="position">
            
            <div class="item_scroll">
                {% for item in items %}
                <div class="item_image" 
                 data-name="{{ item.itemInfo.itemName }}"
                 data-category="{{ item.itemInfo.itemCategory }}"
                 data-info="{{ item.itemInfo.itemInfo }}"
                 data-img="{% static 'img/store/' %}{{ item.itemInfo.itemName }}.png"
                 data-count="{{ item.itemCount }}">
                
                <p class="item_count">x{{item.itemCount}}</p>
                <img src="{% static 'img/store/' %}{{ item.itemInfo.itemName }}.png">
                </div>
                {% endfor %}
            </div>

            <div class="gold_content">
                <div class="token2">
                    <img src="{% static 'img/갈레온.png' %}" alt="Galleon">
                    <span>{{charinfo.gold}} G</span>
                </div>
                <div class="token2">
                    <img class="token2_img" src="{% static 'img/토큰.png' %}" alt="Token">
                    <span>{{charinfo.exp}} EXP</span>
                </div>
            </div>
        </div>
        

        <div id="itemModal" class="modal-overlay" style="display:none;">
            <div class="modal-content">
                <span class="modal-close-btn">&times;</span>
                <img id="modalItemImage" src="" alt="Item Image">
                <p id="modalItemName"></p>
                <p id="modalItemCategory" class="category"></p>
                <p id="modalItemInfo" class="item_info"></p>
            </div>
        </div>
    </div>

</div>

</div>




<script>
document.addEventListener('DOMContentLoaded', function() {
    const houseIcon = document.querySelector('.fa-circle-user');
    //const relationIcon = document.querySelector('.fa-address-book');
    const invenIcon = document.querySelector('.fa-briefcase');

    const profileSection = document.getElementById('profile-section');
    //const relationSection = document.getElementById('relation-section');
    const invenSection = document.getElementById('inven-section');

    profileSection.style.display = 'none';
    //relationSection.style.display = 'none';
    invenSection.style.display = 'block';

    houseIcon.addEventListener('click', () => {
        profileSection.style.display = 'block';
        //relationSection.style.display = 'none';
        invenSection.style.display = 'none';
    });

    // '주소록' 아이콘 클릭 이벤트
    //relationIcon.addEventListener('click', () => {
    //    profileSection.style.display = 'none';
    //    relationSection.style.display = 'block';
    //    invenSection.style.display = 'none';
    //});

    // '가방' 아이콘 클릭 이벤트
    invenIcon.addEventListener('click', () => {
        profileSection.style.display = 'none';
        //relationSection.style.display = 'none';
        invenSection.style.display = 'block';
    });


    // --- 2. 기존에 작성하신 프로필 하위 섹션(PERSONALITY 등) 관련 스크립트 ---
    const buttons = document.querySelectorAll('.sub_section');
    const contents = {
        'PERSONALITY': document.querySelector('.content_personality'),
        'APPEARANCE': document.querySelector('.content_appearance'),
        'ETC': document.querySelector('.content_etc'),
        'STATS': document.querySelector('.content_stats'),
    };
    
    // 페이지 로드 시 PERSONALITY 섹션이 기본으로 보이도록 설정합니다.
    Object.values(contents).forEach(c => {
        if (c) c.style.display = 'none';
    });
    if (contents['PERSONALITY']) {
        contents['PERSONALITY'].style.display = 'block';
    }


    buttons.forEach(button => {
        button.addEventListener('click', () => {
            // 모든 하위 섹션을 일단 숨깁니다.
            Object.values(contents).forEach(c => {
                if (c) c.style.display = 'none';
            });

            // 클릭된 버튼에 해당하는 섹션만 보여줍니다.
            const key = button.textContent.trim();
            if (contents[key]) {
                contents[key].style.display = 'block';
            }
        });
    });
});


// member/profile.html 의 <script> 태그 안에 추가

document.addEventListener('DOMContentLoaded', function() {
    
    // --- (기존의 다른 스크립트 코드는 여기에 그대로 둡니다) ---


    // --- 아이템 클릭 모달 스크립트 ---
    const itemModal = document.getElementById('itemModal');
    const closeBtn = document.querySelector('.modal-close-btn');
    const allItems = document.querySelectorAll('.item_image');

    // 각 아이템에 클릭 이벤트 추가
    allItems.forEach(item => {
        item.addEventListener('click', () => {
            // 1. 클릭된 아이템의 data-* 속성에서 정보 가져오기
            const name = item.dataset.name;
            const category = item.dataset.category;
            const info = item.dataset.info;
            const imgSrc = item.dataset.img;

            // 2. 가져온 정보로 모달 내부 채우기
            document.getElementById('modalItemImage').src = imgSrc;
            document.getElementById('modalItemName').textContent = name;
            document.getElementById('modalItemCategory').textContent = category;
            document.getElementById('modalItemInfo').textContent = info;
            
            // 3. 모달 보여주기
            itemModal.style.display = 'flex';
        });
    });

    // 닫기 버튼 클릭 시 모달 숨기기
    closeBtn.addEventListener('click', () => {
        itemModal.style.display = 'none';
    });

    // 모달 배경 클릭 시 모달 숨기기
    itemModal.addEventListener('click', (event) => {
        if (event.target === itemModal) {
            itemModal.style.display = 'none';
        }
    });

});
</script>

{% endblock %}